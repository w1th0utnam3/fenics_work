# ttbench

*Module to test the performance of `tabulate_tensor` functions generated by FFC*

## Basic usage

The recommended way to use the benchmarking tool is to call it as a module, i.e.
```
python3 -m ttbench [subcommand] [[parameters]]
```
The following subcommands are currently available:
 - `generate [data_filename, out]`: Prepare benchmarking data by calling FFC etc., requires a working installation of FFC
 - `run [data_filename, in] [report_filename, out]`: Run benchmark by loading a generated data file and store the results in a report file, does not require FFC
 - `plot [report_filename, out]`: Plot benchmark reports (accepts multiple files), also prints the report in form of a table

## Dependencies

Python package dependencies:

 - **General**:
   - `dataclasses`
   - `numpy`
 - **For `generate`**:
   - `ffc`
   - `ufl`
 - **For `run`**:
   - `cffi`
 - **For `plot`**:
   - `pandas`
   - `matplotlib`

## Annoyances
The configuration of the `generate` and `plot` commands is currently hardcoded in the `config.py` file. This includes the specific configuration of the benchmark that will be generated for the former and the selection of values to plot for the latter. This might change in the future. To configure your own benchmark, look at `config.py` and `types.py`.

In order to run the tool as a package form any location, add the parent folder (i.e. folder containing this readme) of the package folder to the `PYTHONPATH` environment variable, e.g.
```
PYTHONPATH=${PYTHONPATH}:[Path to this folder] python3 -m ttbench [subcommand] [[parameters]]
```

To store data, the tool uses the `pickle` package which generates binary files.

When running the benchmarks, the individual tests are compiled using CFFI. This may generate a lot of files in the working directory which cannot be deleted by the tool itself: the generated modules are imported dynamically and are locked for writing until the executing Python interpreter terminates.

To run the benchmarks with a different compiler you have to specify the `CC` and `LDSHARED` environment variables, e.g.
```
CC=icc LDSHARED="icc -shared" python3 -m ttbench run [data_filename]
```